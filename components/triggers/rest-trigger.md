---
description: >-
  Learn more about the REST Trigger and how to use it on the Digibee Integration
  Platform.
---

# REST Trigger

When a pipeline is configured and published with **REST Trigger**, a REST endpoint is automatically created. You can visualize this endpoint after the deployment - just click on the pipeline card in the Run screen.

With this trigger, you can create APIs that meet the REST standard and quickly define which methods your endpoint will answer to.

## Parameters

Take a look at the configuration parameters of the trigger. Parameters supported by [Double Braces expressions](../../build/double-braces/) are marked with `(DB)`.

<table data-full-width="true"><thead><tr><th>Parameter</th><th>Description</th><th width="196">Default value</th><th>Data type</th></tr></thead><tbody><tr><td><strong>Methods</strong></td><td>Configures the HTTP verbs to be supported by the endpoint after the deployment. <br><br>If no value is informed, the default value will be considered.</td><td>POST, PUT, GET, PATCH, DELETE and OPTIONS</td><td>String</td></tr><tr><td><strong>Maximum Timeout</strong></td><td>Limit time (in milliseconds) for the pipeline to process information before returning a response. Limit: 900000</td><td>30000</td><td>Integer</td></tr><tr><td><strong>Maximum Request Size</strong></td><td>Maximum size of the payload (in MB). The maximum size of the configurable payload is 5MB.</td><td>5</td><td>Integer</td></tr><tr><td><strong>Response Headers</strong> <code>(DB)</code></td><td>Headers to be returned by the endpoint when processing in the pipeline is complete. <br><br>Cannot be left empty. Accepts Double Braces.</td><td>N/A</td><td>String</td></tr><tr><td><strong>Add Cross-Origin Resource Sharing (CORS)</strong></td><td>Add the CORS headers to be returned by the endpoint when processing in the pipeline is complete. </td><td>False</td><td>Boolean</td></tr><tr><td><strong>CORS Headers</strong></td><td>Specifies CORS for the pipeline.</td><td>N/A</td><td>Key-value pair</td></tr><tr><td><strong>External API</strong></td><td>If enabled, publishes the API in an external gateway.</td><td>True</td><td>Boolean</td></tr><tr><td><strong>Internal API</strong></td><td>If enabled, publishes the API in an internal gateway. <br><br>The pipeline can have both the External API and Internal API options enabled simultaneously.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>mTLS enabled API</strong></td><td>If enabled, publishes the API to a dedicated gateway with mTLS enabled by default.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>API Key</strong></td><td>If enabled, the endpoint can only be consumed if an API key is configured in the Digibee Integration Platform.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>Token JWT</strong></td><td>If enabled, the endpoint can only be consumed if a JWT token previously generated by another endpoint is sent.<br><br>Read the article about <a href="../security-components/digibee-jwt/digibee-jwt-implementation.md">JWT implementation</a> to have more details.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>Basic Auth (</strong><a href="https://docs.digibee.com/documentation/general/beta-program"><strong>Beta Phase</strong></a><strong>)</strong></td><td>If enabled, the endpoint can only be consumed if a Basic Auth setting is present in the request.<br><br>This setting can be registered beforehand through the <strong>Consumers</strong> page in the Digibee Integration Platform.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>Additional API Routes</strong></td><td>If enabled, allows configuration of new routes for the trigger.<br><br>See more about this parameter in the <a href="rest-trigger.md#h_98225d7a95">section</a> below.</td><td>False </td><td>Boolean</td></tr><tr><td><strong>Remove Digibee Prefix from Route</strong></td><td>Removes the default Digibee route prefix if certain conditions are met.<br><br>Learn more about the <strong>Remove Digibee Prefix</strong> <strong>from Route</strong> parameter in the <a href="rest-trigger.md#remove-digibee-prefix-from-route">section</a> below.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>Routes</strong></td><td>Displayed when the <strong>Additional API Routes</strong> parameter is enabled; <br><br>used to define additional endpoint routes.</td><td>N/A</td><td>String</td></tr><tr><td><strong>Rate Limit</strong></td><td>If activated, applies a rate limiting configuration on the API gateway. Available if <strong>API Key</strong> or <strong>Basic Auth</strong> is active.</td><td>False</td><td>Boolean</td></tr><tr><td><strong>Limit by</strong></td><td>Defines the entity to which the limits will be applied. Options: API.</td><td>API</td><td>String</td></tr><tr><td><strong>Aggregate by</strong></td><td>Defines the entity for aggregating the limits. <br><br>Options: Consumer and Credential (API Key, Basic Auth).</td><td>Consumer</td><td>String</td></tr><tr><td><strong>Options</strong></td><td>Defines the limit of requests that can be made within a time interval.</td><td>N/A</td><td>Options of Rate Limit</td></tr><tr><td><strong>Interval</strong></td><td>Defines the time interval for the limit of requests. Options: second, minute, hour, day, and month.</td><td>Second</td><td>String</td></tr><tr><td><strong>Limit</strong></td><td>Defines the maximum number of requests that users can make in the specified time interval.</td><td>N/A</td><td>Integer</td></tr><tr><td><strong>Allow Redelivery Of Messages</strong></td><td>If enabled, allows the message to be resent if the Pipeline Engine fails.<br><br>Read the article about the <a href="https://docs.digibee.com/documentation/platform/pipeline-engine">Pipeline Engine</a> to have more details.</td><td>False</td><td>Boolean</td></tr></tbody></table>

{% hint style="info" %}
There is a global configuration parameter that obliges all the pipelines to be published with at least the **API Key** or **Basic Auth** options enabled.
{% endhint %}

## Parameters additional information

### **Maximum Request Size**

If the payload sent by the endpoint consumer goes beyond the limit, a message will be returned informing that the maximum size has been overcome and a status-code 413 with the following message:

```
{  
    "message": "Request size limit exceeded"
}
```

### **Add Cross-Origin Resource Sharing (CORS) - CORS Headers**&#x20;

Cross-Origin Resource Sharing (CORS) is a mechanism that lets you tell the browser which origins are allowed to make requests. This parameter defines CORS specifically for the pipeline and its constraints. To configure globally rather than individually on each pipeline see the [CORS Global article](triggers-settings/cors-global.md).&#x20;

We use a comma to enter multiple values in a header, but we don't add a space before or after the comma. Special characters should not be used in keys, due to possible failures in proxies and gateways.

### **mTLS enabled API**

The pipeline can have both the External API and Internal API options enabled at the same time, but it is recommended to leave them inactive. This parameter does not support API Key, JWT, or Basic Auth.&#x20;

To use it in your realm, it is necessary to make a request via chat and we will send you the necessary information to install this service.

## Additional API Routes <a href="#h_98225d7a95" id="h_98225d7a95"></a>

As previously explained, this option is to configure new routes in the endpoint.

When a pipeline is deployed, an URL is automatically created. However, you can customize the route according to your convenience. It also includes receiving parameters through the route.

After the pipeline's deployment, the URL will get the following structure:

TEST:&#x20;

```
https://test.godigibee.io/pipeline/{realm}/v{n}/{pipeline-name}
```

or PROD:&#x20;

```
https://api.godigibee.io/pipeline/{realm}/v{n}/{pipeline-name}
```

* **{realm}:** corresponds to Realm.
* **v{n}:** pipeline's major version.
* **{pipeline-name}:** name given to the pipeline.

## Custom static route <a href="#h_2ef14e919f" id="h_2ef14e919f"></a>

Let’s say you’ve created the _product-list_ pipeline. Considering the comment above, its URL would have the following appearance:

```
https://test.godigibee.io/pipeline/realm/v1/product-list
```

Now, see how to configure a static route for this case.

![](<../../.gitbook/assets/rest trigger.png>)

With the configurations applied and the pipeline deployed, you will get a new URL:

```
https://test.godigibee.io/pipeline/realm/v1/products
```

## Custom route with parameter in the path <a href="#h_f97bfe1fe5" id="h_f97bfe1fe5"></a>

Using as example the same pipeline previously configured, see how to configure the route:

![](<../../.gitbook/assets/rest trigger1.png>)

With the configurations applied and the pipeline deployed, you will get a new URL:

```
https://test.godigibee.io/pipeline/realm/v1/products/:id
```

In this case, the endpoint consumer can send a request with the id of a product and return information about it only. Example of URL in the request:

```
https://test.godigibee.io/pipeline/realm/v1/products/10156
```

To use this value sent by the route inside the pipeline, go for the Double Braces syntax:

```
{{ message.queryAndPath.id }}
```

## Remove Digibee Prefix from Route

As previously explained, this option is recommended for removing the default Digibee route prefix from pipeline route.&#x20;

Let’s say you’ve created a pipeline and set the trigger as follows:

<figure><img src="../../.gitbook/assets/Doc update triggers Remove Digibee Prefix mar 2023 (2) (1).png" alt=""><figcaption></figcaption></figure>

With the configurations applied and the pipeline deployed, you will get a new URL:

```
https://test.godigibee.io/products
```

{% hint style="info" %}
When removing the default prefix and setting the pipeline route through the **Additional API Routes** parameter, be careful not to set an existing pipeline route used by other pipelines. In case you have more than one pipeline major version, it’s also important to keep in mind that the pipeline route versioning must be done by the user due the absence of a versioning path parameter. For example: /pipeline/realm/v1/.
{% endhint %}

## Rate Limit <a href="#h_2a3d3d19e6" id="h_2a3d3d19e6"></a>

When creating APIs, we usually want to limit the number of API requests users can make in a given time interval.

This action can be performed by activating the **Rate Limit** option and applying the following settings:



<figure><img src="../../.gitbook/assets/REST trigger rate limit example ago 2023.png" alt=""><figcaption></figcaption></figure>

If the API has additional paths, the limit is shared among all paths. To apply the rate limit settings, the API must be configured with an API key or Basic Auth so that the **Aggregate by** parameter can be used by groups of credentials if the Consumer option is selected, or by an individual credential if the Credential (API Key, Basic Auth) option is selected.

If multiple interval parameters are configured with repeating values, only one of these values is considered. It’s also necessary that a value greater than zero be informed for the **Limit** parameter.

If the rate limiting options aren't set correctly, they'll be ignored and a warning log will be issued. You can view this log on the Pipeline Logs page.

## REST Trigger in Action <a href="#h_2a3d3d19e6" id="h_2a3d3d19e6"></a>

See below how the trigger behaves in specific situations and what its respective configuration is.

### **Query API of information with response in JSON**

See how to configure a pipeline with **REST Trigger** to return information inside the pipeline in JSON format and how the return must be treated specifically for this trigger.

First of all, create a new pipeline and configure the trigger. The configuration can be made in the following way:

![](<../../.gitbook/assets/rest trigger2.png>)

With the configurations above, you determine that:

* the endpoint works with the verb GET only.

Besides, you determine that the API is external and doesn’t need a token for the communication.

{% hint style="info" %}
This example works for educational matters only. In some cases you can’t let the endpoint open for security reasons.
{% endhint %}

Now see how to configure a [MOCK](../tools/json-generator.md) in the pipeline so it becomes the data provider that the endpoint returns in the end. Place the indicated component, connect it to the trigger and configure it with the following JSON:

```
{
    "data": {
        "products": [
            {
                "name": "Samsung 4k Q60T 55",
                "price": 3278.99
            },
            {
                "name": "Samsung galaxy S20 128GB",
                "price": 3698.99
            }
        ]
    }
}
```

After doing that, the endpoint will already automatically return the JSON defined above as the endpoint response.

After the deployment, take the generated url and send a GET-type request. The endpoint must return the status-code 200 and the response body must have the same appearance of the JSON we previously defined inside the MOCK component.

### **Dispatch API of information with response in JSON**

See how to configure a pipeline with _**REST Trigger**_ to return information inside the pipeline in JSON format and how the return must be treated specifically for this trigger.

First of all, create a new pipeline and configure the trigger. The configuration can be made in the following way:

![](<../../.gitbook/assets/rest trigger4.png>)

With the configurations above, you determine that:

* the endpoint works with the verb POST only.

Besides, you determine that the API is external and doesn’t need a token for the communication.

{% hint style="info" %}
This example works for educational matters only. In some cases you can’t let the endpoint open for security reasons.
{% endhint %}

Now see how to configure a [MOCK](../tools/json-generator.md) in the pipeline so it changes the received data and the endpoint will return in the end. Place the indicated component, connect it to the trigger and configure it with the following JSON:

```
{
    "data": {
        "products": [
            {
                "name": "Samsung 4k Q60T 55",
                "price": 3278.99
            },
            {
                "name": "Samsung galaxy S20 128GB",
                "price": 3698.99
            },
            {{ message.body.product }}
        ]
    }
}
```

With this configuration, a payload with a new product will be received and it will be added to the array. After that, the pipeline will return the array with the new added product to the consumer.

After the deployment, take the generated url and send a POST-type request with the following body:

```
{
    "product": {
        "name": "Samsung galaxy note 10 256GB",
        "price": 2879.99
    }
}
```

The endpoint must return the status-code 200 and the response body must have the following appearance:

```
{
  "data": {
    "products": [
      {
        "name": "Samsung 4k Q60T 55",
        "price": 3278.99
      },
      {
        "name": "Samsung galaxy S20 128GB",
        "price": 3698.99
      },
      {
        "name": "Samsung galaxy note 10 256GB",
        "price": 2879.99
      }
    ]
  }
}
```

Everytime you make a request to the created endpoint, the structure of the message that the trigger delivers to the pipeline is always the same and follows this pattern:

```
{
  "body": "{}",
  "form": {},
  "headers": {
    "Host": "pipeline-trigger-http:8100",
    "Connection": "keep-alive",
    "X-Forwarded-For": "***",
    "X-Forwarded-Proto": "http",
    "X-Forwarded-Host": "***",
    "my-custom-header": "a"
  },
  "queryAndPath": {
    "id": "1"
  },
  "method": "POST",
  "contentType": "application/json",
  "path": "/pipeline/digibee/v1/trigger-rest/1"
}
```

* **body:** content to be sent in the request payload to be transformed into string in this field.
* **form:** if the form-data is used in the request, the sent data is delivered in this field.
* **headers:** the headers sent in the request are delivered in this field, but some are automatically filled according to the tool used to make the request.
* **queryAndPath:** the query and path parameters provided in the URL are delivered in this field.
* **method:** HTTP method used in the request to be delivered in this field.
* **contentType:** when informed in the request, the Content-type value is repassed to the pipeline inside this field.
* **path:** the path used in the URL in the request is repassed to this field.
